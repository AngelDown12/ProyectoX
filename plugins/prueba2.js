import { WAMessageStubType } from '@whiskeysockets/baileys';

let handler = async (m, { conn }) => {
    if (!m.messageStubType || !m.isGroup) return;
    
    let chat = global.db.data.chats[m.chat];
    if (!chat?.detect) return;
    
    if (m.messageStubType === 26) {
        let usuario = `@${m.sender.split('@')[0]}`;
        let isOn = m.messageStubParameters[0] === 'on';
        
        let text = isOn ? 
            `*âš ï¸ ğ˜¾ğ™Šğ™‰ğ™ğ™„ğ™‚ğ™ğ™ğ˜¼ğ˜¾ğ™„ğ™Šğ™‰ ğ˜¿ğ™€ğ™‡ ğ™‚ğ™ğ™ğ™‹ğ™Š âš ï¸*\n\n*ğ™€ğ™¡ ğ™–ğ™™ğ™¢ğ™ğ™£ğ™ğ™¨ğ™©ğ™§ğ™–ğ™™ğ™¤ğ™§ ${usuario} ğ™ğ™– ğ™–ğ™˜ğ™©ğ™ğ™«ğ™–ğ™™ğ™¤ ğ™šğ™¡ ğ™¢ğ™¤ğ™™ğ™¤ "ğ™ğ™¤ğ™¡ğ™¤ ğ™–ğ™™ğ™¢ğ™ğ™£ğ™ğ™¨ğ™©ğ™§ğ™–ğ™™ğ™¤ğ™§ğ™šğ™¨"* ğŸ”’\n\n*ğ˜¼ğ™ğ™¤ğ™§ğ™– ğ™¨ğ™¤ğ™¡ğ™¤ ğ™¡ğ™¤ğ™¨ ğ™–ğ™™ğ™¢ğ™ğ™£ğ™ğ™¨ğ™©ğ™§ğ™–ğ™™ğ™¤ğ™§ğ™šğ™¨ ğ™¥ğ™ªğ™šğ™™ğ™šğ™£ ğ™šğ™£ğ™«ğ™ğ™–ğ™§ ğ™¢ğ™šğ™£ğ™¨ğ™–ğ™Ÿğ™šğ™¨ ğ™–ğ™¡ ğ™œğ™§ğ™ªğ™¥ğ™¤.*` :
            `*âš ï¸ ğ˜¾ğ™Šğ™‰ğ™ğ™„ğ™‚ğ™ğ™ğ˜¼ğ˜¾ğ™„ğ™Šğ™‰ ğ˜¿ğ™€ğ™‡ ğ™‚ğ™ğ™ğ™‹ğ™Š âš ï¸*\n\n*ğ™€ğ™¡ ğ™–ğ™™ğ™¢ğ™ğ™£ğ™ğ™¨ğ™©ğ™§ğ™–ğ™™ğ™¤ğ™§ ${usuario} ğ™ğ™– ğ™™ğ™šğ™¨ğ™–ğ™˜ğ™©ğ™ğ™«ğ™–ğ™™ğ™¤ ğ™šğ™¡ ğ™¢ğ™¤ğ™™ğ™¤ "ğ™ğ™¤ğ™¡ğ™¤ ğ™–ğ™™ğ™¢ğ™ğ™£ğ™ğ™¨ğ™©ğ™§ğ™–ğ™™ğ™¤ğ™§ğ™šğ™¨"* ğŸ”“\n\n*ğ˜¼ğ™ğ™¤ğ™§ğ™– ğ™©ğ™¤ğ™™ğ™¤ğ™¨ ğ™¡ğ™¤ğ™¨ ğ™¥ğ™–ğ™§ğ™©ğ™ğ™˜ğ™ğ™¥ğ™–ğ™£ğ™©ğ™šğ™¨ ğ™¥ğ™ªğ™šğ™™ğ™šğ™£ ğ™šğ™£ğ™«ğ™ğ™–ğ™§ ğ™¢ğ™šğ™£ğ™¨ğ™–ğ™Ÿğ™šğ™¨ ğ™–ğ™¡ ğ™œğ™§ğ™ªğ™¥ğ™¤.*`;

        let fkontak = {
            key: {
                participants: "0@s.whatsapp.net",
                remoteJid: "status@broadcast",
                fromMe: false,
                id: "Halo"
            },
            message: {
                contactMessage: {
                    displayName: "ğ™‚ğ™§ğ™ªğ™¥ğ™¤ ğ™ˆğ™¤ğ™™ğ™ğ™›ğ™ğ™˜ğ™–ğ™™ğ™¤",
                    vcard: `BEGIN:VCARD\nVERSION:3.0\nN:XL;${usuario}\nFN:${usuario}\nitem1.TEL;waid=${m.sender.split('@')[0]}:${m.sender.split('@')[0]}\nitem1.X-ABLabell:Ponsel\nEND:VCARD`
                }
            },
            participant: "0@s.whatsapp.net"
        };

        try {
            await conn.sendMessage(m.chat, { 
                text: text,
                mentions: [m.sender]
            }, {
                quoted: fkontak,
                ephemeralExpiration: 86400
            });
            console.log(`[GROUP] Announce mode ${isOn ? 'enabled' : 'disabled'} in ${m.chat} by ${m.sender}`);
        } catch (error) {
            console.error('[ERROR] Failed to send message:', error);
        }
    }
}

handler.group = true;
handler.before = true;

export default handler; 
